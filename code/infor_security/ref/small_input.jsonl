{"Score": 1, "Title": "When 'while looping' a mysql $row result it only works in the first instance", "Body": "<p>Can anyone help - this is driving me mad.</p>\n\n<p>I am calling a mysql table and wish to display the results (or check the results with an if statement) more than once. But in this loop (see below) it only calls the table and its rows as an array in the first instance (of $i=1). This code will build 20 divs called Box but only populate the first one with table data. Why?</p>\n\n<p>I think that I should be using a foreach loop within the outer loop (I have got this to work in wordPress with that btw) but can't figure out the syntax. Any help would be really appreciated.</p>\n\n<pre><code>$i=1;\nwhile ($i &lt;= 20)\n{\n    echo \"&lt;div class=\\\"Box \".$i.\"\\\"&gt;\";\n    echo $i;\n    echo \"&lt;br&gt;\";\n    while ($row = mysql_fetch_array($result))\n    {\n    echo $row['name'];\n    }\n    echo \"&lt;/div&gt;\";\n    $i++;\n\n}\n</code></pre>\n", "Tags": "<php><mysql><loops>", "Answer_Score": 1, "Answer_Body": "<p>If I understand, you are attempting to use the same result resource multiple times in a loop.</p>\n\n<p>After looping over the result resource the first time, you need to rewind it back to its original position to be able to loop over it again.  It can be rewound with <code>mysql_data_seek($result, 0)</code>, but a better strategy is to load the whole thing into an array before your loops and then iterate the array in each loop:</p>\n\n<pre><code>// Load everything into the array `$results` first.\n$results = array();\nwhile ($row = mysql_fetch_assoc($result)) {\n  $results[] = $row['name'];\n}\n\n// Better an incremental for loop than a while with a counter\n// for a situation where you know the endpoint values of $i\nfor ($i = 1; $i &lt;= 20; $i++)\n{\n    echo \"&lt;div class='Box $i'&gt;\";\n    echo $i;\n    echo \"&lt;br&gt;\";\n    // Inside your HTML, use the $results array \n    // rather than the MySQL resource\n    foreach ($results as $row)\n    {\n      echo $row['name'];\n    }\n    echo \"&lt;/div&gt;\";\n}\n</code></pre>\n", "Question_ID": 1}
{"Score": 1, "Title": "When 'while looping' a mysql $row result it only works in the first instance", "Body": "<p>Can anyone help - this is driving me mad.</p>\n\n<p>I am calling a mysql table and wish to display the results (or check the results with an if statement) more than once. But in this loop (see below) it only calls the table and its rows as an array in the first instance (of $i=1). This code will build 20 divs called Box but only populate the first one with table data. Why?</p>\n\n<p>I think that I should be using a foreach loop within the outer loop (I have got this to work in wordPress with that btw) but can't figure out the syntax. Any help would be really appreciated.</p>\n\n<pre><code>$i=1;\nwhile ($i &lt;= 20)\n{\n    echo \"&lt;div class=\\\"Box \".$i.\"\\\"&gt;\";\n    echo $i;\n    echo \"&lt;br&gt;\";\n    while ($row = mysql_fetch_array($result))\n    {\n    echo $row['name'];\n    }\n    echo \"&lt;/div&gt;\";\n    $i++;\n\n}\n</code></pre>\n", "Tags": "<php><mysql><loops>", "Answer_Score": 1, "Answer_Body": "<p>Maybe I don't understand well but you should try this :</p>\n\n<pre><code>$i=1;\nwhile ($row = mysql_fetch_array($result) &amp;&amp; $i &lt;= 20) {\n    echo \"&lt;div class=\\\"Box \".$i.\"\\\"&gt;\";\n    echo $i;\n    echo \"&lt;br&gt;\";\n    echo $row['name'];\n    echo \"&lt;/div&gt;\";\n    $i++;\n}\n</code></pre>\n\n<p>Because in your code, you do your \"mysql loop\" inside the first loop.</p>\n", "Question_ID": 1}
{"Score": 2, "Title": "How to import sql.gz file to mysql database using python script?", "Body": "<p>I export a database using <code>mysqldump</code> in the <code>sql.gz</code> format using a python script. How can I import that <code>sql.gz</code> file using this python script?</p>\n\n<p>I wrote code which works for <code>.sql</code> or <code>.txt</code> files.</p>\n\n<pre><code>import MySQLdb\n\n\nfilename = self.ui.txtFileLocationImport.text()\n\n# Open database connection\ndb = MySQLdb.connect(dbHostName, dbUser, dbPassword, databaseName)\n\n# prepare a cursor object using cursor() method\ncursor = db.cursor()\n\n#Prepare SQL query to INSERT a record into the database.\nf = open(filename , 'r')\ntry:\n    cursor.execute('SET foreign_key_checks = 0')\n    for sql in f:\n        if sql == '\\n' or sql[0] == '/':\n            pass\n        else:\n            # Execute the SQL command\n            cursor.execute(str(sql))\n\n    #Commit your changes in the database\n    cursor.execute('SET foreign_key_checks = 1')\n    db.commit()\nexcept Exception as e:\n   print e\n   # Rollback in case there is any error\n   db.rollback()\n\n#close file\nf.close()\n# disconnect from server\ndb.close()\n</code></pre>\n\n<p>This only works for <code>.txt</code> and <code>.sql</code> file. How can I make this read a <code>sql.gz</code> file?</p>\n", "Tags": "<python><file-io><python-2.7><mysqldump><mysql-python>", "Answer_Score": 1, "Answer_Body": "<p>With the contents of the <a href=\"http://docs.python.org/library/gzip.html\" rel=\"nofollow\"><code>gzip</code></a> module.</p>\n", "Question_ID": 2}
{"Score": 8, "Title": "Tricky SQL query involving consecutive values", "Body": "<p>I need to perform a relatively easy to explain but (given my somewhat limited skills) hard to write SQL query.</p>\n\n<p>Assume we have a table similar to this one:</p>\n\n<pre><code> exam_no | name | surname | result | date\n---------+------+---------+--------+------------\n 1       | John | Doe     | PASS   | 2012-01-01\n 1       | Ryan | Smith   | FAIL   | 2012-01-02 &lt;--\n 1       | Ann  | Evans   | PASS   | 2012-01-03\n 1       | Mary | Lee     | FAIL   | 2012-01-04\n ...     | ...  | ...     | ...    | ...\n 2       | John | Doe     | FAIL   | 2012-02-01 &lt;--\n 2       | Ryan | Smith   | FAIL   | 2012-02-02\n 2       | Ann  | Evans   | FAIL   | 2012-02-03\n 2       | Mary | Lee     | PASS   | 2012-02-04\n ...     | ...  | ...     | ...    | ...\n 3       | John | Doe     | FAIL   | 2012-03-01\n 3       | Ryan | Smith   | FAIL   | 2012-03-02\n 3       | Ann  | Evans   | PASS   | 2012-03-03\n 3       | Mary | Lee     | FAIL   | 2012-03-04 &lt;--\n</code></pre>\n\n<p>Note that <code>exam_no</code> and <code>date</code> aren't necessarily related as one might expect from the kind of example I chose.</p>\n\n<p>Now, the query that I need to do is as follows:</p>\n\n<ul>\n<li>From the latest exam (<code>exam_no</code> = 3) find all the students that have failed (<code>John Doe</code>, <code>Ryan Smith</code> and <code>Mary Lee</code>).</li>\n<li>For each of these students find the date of the first of the batch of consecutively failing exams. Another way to put it would be: for each of these students find the date of the first failing exam that comes after their last passing exam. (Look at the arrows in the table).</li>\n</ul>\n\n<p>The resulting table should be something like this:</p>\n\n<pre><code> name | surname | date_since_failing\n------+---------+--------------------\n John | Doe     | 2012-02-01\n Ryan | Smith   | 2012-01-02\n Mary | Lee     | 2012-03-04\n</code></pre>\n\n<p>How can I perform such a query?</p>\n\n<p>Thank you for your time.</p>\n", "Tags": "<mysql><sql><database>", "Answer_Score": 4, "Answer_Body": "<p>You can take advantage of the fact that if someone passed the most recent exam, then they have not failed any exams since their most recent pass: therefore the problem reduces to finding the first exam failed since the most recent pass:</p>\n\n<pre><code>SELECT   name, surname, MIN(date) date_since_fail\nFROM     results NATURAL LEFT JOIN (\n  SELECT   name, surname, MAX(date) lastpass\n  FROM     results\n  WHERE    result = 'PASS'\n  GROUP BY name, surname\n) t\nWHERE    result = 'FAIL' AND date &gt; IFNULL(lastpass,0)\nGROUP BY name, surname\n</code></pre>\n\n<p>See it on <a href=\"http://sqlfiddle.com/#!2/12b93/1/0\" rel=\"nofollow\">sqlfiddle</a>.</p>\n", "Question_ID": 3}
{"Score": 5, "Title": "Use max column value in order by", "Body": "<p>I'm trying to order a table by two columns, each with a different weighting. The first is <code>uptime</code>, which is a value between 0 and 1 and has a weighting of 0.3. The second is <code>votes</code>, which is a non-negative integer and has a weighting of 0.7.</p>\n\n<p>The weighting needs to be multiplied by a value between 0-1, so I'm going to get this for votes by dividing the number of votes for each row by the maximum number of votes held by any row.</p>\n\n<p>This is my query so far, and it almost works:</p>\n\n<pre><code>SELECT addr\n  FROM servers\n  ORDER BY (0.3 * uptime) +\n           (0.7 * (votes / 100)) DESC\n</code></pre>\n\n<p>The 100 is hard-coded and should be the maximum value of <code>votes</code>. Using <code>MAX(votes)</code> makes the query return only the record with highest number of votes. Can this be done in a single query?</p>\n", "Tags": "<mysql><sql><sql-order-by><weighting>", "Answer_Score": 2, "Answer_Body": "<p>You could use a subquery for selecting the maximum value of <code>votes</code></p>\n\n<pre><code>SELECT addr\n  FROM servers\n  ORDER BY (0.3 * uptime) +\n           (0.7 * (votes / (SELECT MAX(votes) FROM servers))) DESC\n</code></pre>\n\n<p>Example fiddle <a href=\"http://sqlfiddle.com/#!2/0c1b3/4/0\" rel=\"nofollow\">here</a>.</p>\n", "Question_ID": 4}
{"Score": 5, "Title": "Use max column value in order by", "Body": "<p>I'm trying to order a table by two columns, each with a different weighting. The first is <code>uptime</code>, which is a value between 0 and 1 and has a weighting of 0.3. The second is <code>votes</code>, which is a non-negative integer and has a weighting of 0.7.</p>\n\n<p>The weighting needs to be multiplied by a value between 0-1, so I'm going to get this for votes by dividing the number of votes for each row by the maximum number of votes held by any row.</p>\n\n<p>This is my query so far, and it almost works:</p>\n\n<pre><code>SELECT addr\n  FROM servers\n  ORDER BY (0.3 * uptime) +\n           (0.7 * (votes / 100)) DESC\n</code></pre>\n\n<p>The 100 is hard-coded and should be the maximum value of <code>votes</code>. Using <code>MAX(votes)</code> makes the query return only the record with highest number of votes. Can this be done in a single query?</p>\n", "Tags": "<mysql><sql><sql-order-by><weighting>", "Answer_Score": 2, "Answer_Body": "<p>Define a variable and use it:</p>\n\n<pre><code>DECLARE @maxVotes int\nSELECT @maxVotes = MAX(votes) from servers\n\nSELECT addr\n  FROM servers\n  ORDER BY (0.3 * uptime) +\n           (0.7 * (votes / @maxVotes)) DESC\n</code></pre>\n\n<p>or use a subquery in the <code>order by</code>:</p>\n\n<pre><code>SELECT addr\n  FROM servers\n  ORDER BY (0.3 * uptime) +\n           (0.7 * ( votes / (SELECT MAX(votes) FROM servers))) DESC\n</code></pre>\n", "Question_ID": 4}
